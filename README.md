# vba-TaskTools

現場運用（紙・Excel）を前提に、**タスク登録 → 対象者の自動割当 → 進捗可視化 → 完了登録（ログ）→ 印刷**までを一気通貫で回す Excel VBA ツールです。  
塾／教室運営のように「生徒×タスク」を大量に扱う状況で、**運用負荷と抜け漏れを減らす**ことを目的に作成しました。

---

## できること（概要）

- **生徒／学校マスタ同期**：外部ブック `Students.xlsm` の内容を差分同期（更新・追加・削除）
- **タスク台帳（TaskList）管理**：タスクID自動採番（T001…）、開始/締切/掲載終了、コメント、対象条件、非表示フラグ
- **対象者の自動割当**：学年・学校区分（設置区分など）・学期制の条件から対象生徒を判定し、`TaskStatus`へ反映
- **進捗の見える化**：対象外は `"-"`（灰色）、完了は日付（灰色）として管理表に反映
- **完了登録フォーム**：週（基準日）×曜日×生徒のチェックで完了日を一括記録（`TaskLog`に保存 → `TaskStatus`へ反映）
- **ダッシュボード**：未完タスクの一覧、進捗率表示、選択タスクのエクスポート
- **印刷用整形**：未完が残るタスク列だけを抽出し、ページ分割して紙運用向けに整形

---

## データ構造（シート）

### TaskList（タスク台帳）
| 列 | 内容 |
|---|---|
| A | TaskID（T001…） |
| B | タスク名 |
| C | 開始日（公開開始） |
| D | 締切日 |
| E | 掲載終了日（公開終了） |
| F | コメント |
| G | 対象：学年（CSV） |
| H | 対象：学校区分/設置区分（CSV） |
| I | 対象：学期制（CSV） |
| J | 非表示フラグ（`1`で非表示） |

※ 対象条件は **OR（CSV）** で扱います（例：`1,2,3`）。

---

### TaskStatus（生徒×タスクの管理表）
- **行**：生徒（6行目から）
- **列**：タスク（F列=6列目以降）
- **ヘッダ行**（例）
  - 1行目：TaskID
  - 2行目：タスク名
  - 4行目：締切日

**セルの意味**
- `""`：未完（対象）
- `日付`：完了（灰色塗り）
- `"-"`：対象外（灰色塗り）

---

### TaskLog（完了ログ）
TaskID×StudentID をキーとして、完了日・記録日を保存します。

| 列 | 内容 |
|---|---|
| A | TaskID |
| B | StudentID |
| C | 生徒名（TaskStatusから参照） |
| D | 学年（TaskStatusから参照） |
| E | CompletedDate（完了日） |
| F | RecordedDate（記録日） |

---

## 主な処理フロー

1. **マスタ同期**
   - `A1_生徒情報同期.bas`：`Students.xlsm` から生徒情報を同期（差分更新＋追加＋削除）
   - `A2_学校情報同期.bas`：`Students.xlsm` から学校情報を同期（差分更新＋追加＋削除）

2. **管理表の生成**
   - `A3_生徒一覧toTaskStatus.bas`：学年降順で生徒一覧を `TaskStatus` に出力（担当講師一覧も生成）
   - `A4_ListtoStatus.bas`：公開中タスクを `TaskStatus` 列（F以降）へ展開（終了日で並び替え）

3. **対象割当 & TaskLog整備**
   - `A6_TaskApplying.bas`：条件判定し、対象外セルを `"-"` にして灰色塗り。対象の TaskID×StudentID を `TaskLog` に追加。

4. **完了記録 → 反映**
   - `frmタスク完了登録.frm`：フォームで完了日を一括登録（`TaskLog`更新）
   - `A5_TaskLog反映.bas`：`TaskLog` の完了日を `TaskStatus` に反映（mm/dd表示＋灰色塗り）

5. **ダッシュボード / エクスポート**
   - `C1_DashBoard.bas` / `Module1.bas`：未完タスク一覧、進捗率、選択タスクのテンプレ出力（`ExportFormat`等のテンプレシートを使用）

6. **印刷**
   - `B3_印刷用整形・印刷.bas`：未完が残るタスク列を抽出し、ページ分割して出力用シートへ整形

---

## 使い方（想定）

- Excelブック側にボタン等を用意し、上記マクロを順に実行して運用します。
- 「新規タスク登録」は `frm新規タスク登録`、  
  「完了登録」は `frmタスク完了登録` から行う設計です。

---

## 実装上の工夫（技術メモ）

- 大量データを想定し、`Variant配列`＋`Dictionary` を多用して高速化
- `TaskStatus` を「行列（可視性）」、`TaskLog` を「ログ（正）」として分離し、紙運用でも整合が崩れにくい設計
- 外部マスタ同期は **差分更新＋追加＋削除** まで含め、運用時のメンテ負荷を削減

